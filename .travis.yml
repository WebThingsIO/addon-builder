dist: bionic
sudo: required

language: node_js
node_js:
  - 8
  - 10
  - 12

env:
  global:
    - HOMEBREW_LOGS=/tmp/homebrew/logs
    - HOMEBREW_TEMP=/tmp/homebrew/tmp

os:
  - linux
  - osx

addons:
  homebrew:
    packages:
      - gnu-tar
    update: true

before_install:
  - mkdir -p /tmp/homebrew/logs
  - mkdir -p /tmp/homebrew/tmp
  - if [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then ./before-install-linux.sh; fi

script:
- ./build-addons.sh

deploy:
  provider: s3
  access_key_id: AKIA43UV6GXGPDPWQHW3
  secret_access_key:
    secure: KO5tjDxwiaHBFL5xPLdUgWZXZyJUnowyd3Suv0hK4xxEd33106vlSZs/efKWcxpvzl+1jo9ptGDYGHrqptSKLUa+1lIUGbMRZ+PdauW7PreKKhQ2hVub3BG1v6xUu745vynAlTJVJGic8onwPVGSuwUcCqtNWa9wXFU3qMZMy9j1gOXFRnZqwGYHqRkCNEqwz2Oy08ihB9ST+qYivuH/ldhaZREVv1C5cmfpEhzhnVXobPO4tEzJh8w+H9EzX8V089kmKbqQOOtKuVe9w0D0C99q5eJ4Qsw9yApmWVrAqF8ipYdjMI3wBl62PvBvUVmpQ83By3M7Dt40EIKaIs+6CUuPhJJP3RVopzE7vs+0esIY8ruomT9TJvQJJIYH/inh6ozlg+KeN6OS+CxI7yTP48eLh60dGo3yOK74qPcwNalrgtGg1ZCYK0svPkSeTGwVtZKn+WGAanxXh4dVqNmUcEyahRLIN5qKxhoNbK3J+ozvyMtBry18mFZ5WbzlK9es5utFamQwy3Nq1oWkhN0gJx9N4YN7QK1gFHlY5gdcRpuiY08Q1H+/yDjSKtYBWM8RtYKO77vJvKMgrP9b40frrPvIuDdfo3PAO5NmWSAvgp24rBOTl+Hnm4I2dKVilLIloQ9rVpgfedAfoEbBfRSatZfpycOawK1/8W1BV7BrKk8=
  bucket: mozilla-gateway-addons
  region: us-west-2
  local-dir: builder
  upload-dir: builder
  acl: public_read
  skip_cleanup: true
